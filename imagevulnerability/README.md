# Image Vulnerability

## Overview

Image vulnerabilities refer to security weaknesses or flaws in the container images used to run workloads in Kubernetes. These vulnerabilities can come from the following user and system pitfalls.
- **Outdated base images**: e.g., old version of Ubuntu, Alpine with known CVEs that are no longer being supported/patched
- **Bundled software with known vulnerabilities**: e.g., an old version of OpenSSL or curl
- **Misconfigurations**: e.g., hardcoded secrets, excessive permissions, or unnecessary packages
- **Unverified sources**: e.g., using images from untrusted registries or sources

## How Image Vulnerabilities Can Be Exploited

Image vulnerabilities can be exploited in various ways, including:
- **Privileged Escalation**: Vulnerable binaries inside the image can allow attackers to gain root access inside the container
- **Remote Code Execution (RCE)**: If the image includes outdated libraries with RCE vulnerabilities, attackers can exploit them via exposed APIs or services
- **Supply Chain Attacks**: Malicious images or compromised dependencies can introduce backdoors
- **Persistence and Lateral Movement**: Attackers can use vulnerable images to pivot across pods or nodes, especially if combined with misconfigured RBAC or network policies

## Justification for Regular Image Vulnerability Scanning and Updates

- **Patch known CVEs**: Most exploits target known vulnerabilities that have patches available
- **Reduce attack surface**: Removing unnecessary packages and updating libraries reduces the number of potential vulnerabilities
- **Compliance**: Adhering to security standards like CIS and NIST requires regularly scanning for image vulnerabilities and updates
- **Prevent Zero-Day Amplification**: Outdated images often lack mitigations for new kernel or library exploits

## Best Practices

It is best practice to integrate image vulnerability scanning into the CI/CD pipeline to catch vulnerabilities before deployment. Additionally, regularly updating base images and dependencies, using minimal and trusted base images, and employing runtime security tools can help mitigate risks associated with image vulnerabilities.

### OS Vulnerability Scanning Tools
- [Trivy](https://github.com/aquasecurity/trivy)

    Scans container images, filesystems, git repositories, virtual machine images, and kubernetes for OS packages, software dependencies, known vulnerabilities (CVEs), IaC issues and misconfiguration, sensitive information (secrets), and software licenses. Trivy integrates with Github Actions, Kubernetes operator, VS Code plugin and many more platforms and applications.

    While user would ideally automate image scanning in their CI/CD pipeline, Trivy can also be used as a standalone tool to scan images on-demand.

    ```shell
    # Example command to scan a python image
    trivy image python:3.4-alpine

    # Example command to scan a project directory for vulnerable dependencies, secrets and misconfigurations
    trivy fs --scanners vuln,secret,misconfig demo/

    # Example command to generate an entire clusters vulnerability report
    trivy k8s --report summary cluster
    ```

- [Grype](https://github.com/anchore/grype)

    Vulnerability scanner for container images and filesystems. Can identify vulnerabilities in major operating system packages, and language-specific packages. Supports Docker, OCI, and Singularity image formats. Also supports OpenVex to filtering and augmenting scanning results.

Admission controllers like gatekeeper?

## Resources
- [Trivy Documentation](https://trivy.dev/latest/docs/)
